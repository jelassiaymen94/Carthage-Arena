{% extends 'base.html.twig' %}

{% block title %}Gestion Boutique - Admin - Carthage Arena{% endblock %}

{% block body %}
<div id="mainContent" class="opacity-0 transition-opacity duration-500">
    <div class="flex min-h-screen bg-background-dark">
        {# Sidebar #}
        {% include 'admin/_sidebar.html.twig' %}

        {# Main Content Area #}
        <main class="flex-1 ml-72 overflow-y-auto h-screen">
            {# Sticky Header #}
            <header class="sticky top-0 z-30 bg-background-dark/80 backdrop-blur-xl border-b border-white/5">
                <div class="flex items-center gap-4 px-8 py-4">
                    <a href="{{ path('app_dashboard') }}" class="p-3 rounded-lg bg-white/5 hover:bg-white/10 text-white hover:text-primary transition-all">
                        <span class="material-symbols-outlined text-[24px]">arrow_back</span>
                    </a>
                    <div class="flex-1 flex items-center justify-between">
                        <div>
                            <h1 class="text-2xl font-bold text-white">Gestion de la Boutique</h1>
                            <p class="text-sm text-white/40 mt-0.5">Gérer les articles et les ventes de la boutique</p>
                        </div>
                        <div class="relative group">
                            <button class="inline-flex items-center gap-2 px-5 py-2.5 bg-primary hover:bg-primary/90 text-white text-sm font-semibold rounded-xl transition-all">
                                <span class="material-symbols-outlined text-[18px]">add</span>
                                + Ajouter
                            </button>
                            <div class="absolute right-0 top-full mt-2 w-48 bg-surface-dark/60 backdrop-blur-xl border border-white/10 rounded-xl shadow-xl overflow-hidden hidden group-hover:block z-50">
                                <a href="{{ path('admin_shop_skin_add') }}" class="block px-4 py-3 text-sm text-white hover:text-white hover:bg-white/10 transition-colors flex items-center gap-2">
                                    <span class="material-symbols-outlined text-[18px] text-purple-400">palette</span>
                                    Nouveau Skin
                                </a>
                                <a href="{{ path('admin_shop_merch_add') }}" class="block px-4 py-3 text-sm text-white hover:text-white hover:bg-white/10 transition-colors flex items-center gap-2">
                                    <span class="material-symbols-outlined text-[18px] text-secondary">checkroom</span>
                                    Nouvel Article
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            {# Page Content #}
            <div class="p-8 space-y-6">
                {# Flash Messages #}
                {% for label, messages in app.flashes %}
                    {% for message in messages %}
                        <div class="p-4 rounded-xl {% if label == 'success' %}bg-green-500/10 border border-green-500/20 text-green-400{% else %}bg-red-500/10 border border-red-500/20 text-red-400{% endif %} flex items-center gap-3">
                            <span class="material-symbols-outlined">{% if label == 'success' %}check_circle{% else %}error{% endif %}</span>
                            <span class="text-sm font-medium">{{ message }}</span>
                        </div>
                    {% endfor %}
                {% endfor %}

                {# Search & Filters #}
                <div class="bg-surface-dark border border-white/5 rounded-2xl p-4">
                    <div class="flex items-center gap-4">
                        <div class="flex-1 relative">
                            <span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-white/30 text-[20px]">search</span>
                            <input type="text" placeholder="Rechercher un article..."
                                   class="w-full bg-white/5 border border-white/10 rounded-xl pl-10 pr-4 py-2.5 text-sm text-white placeholder-white/30 focus:border-primary/50 focus:ring-1 focus:ring-primary/30 outline-none transition-all" />
                        </div>
                        <select class="bg-white/5 border border-white/10 rounded-xl px-4 py-2.5 text-sm text-white/70 outline-none focus:border-primary/50 w-48">
                            <option>Tous les jeux</option>
                            <option>Valorant</option>
                            <option>League of Legends</option>
                            <option>CS:GO 2</option>
                        </select>
                        <select class="bg-white/5 border border-white/10 rounded-xl px-4 py-2.5 text-sm text-white/70 outline-none focus:border-primary/50 w-48">
                            <option>Toutes les raretés</option>
                            <option>Légendaire</option>
                            <option>Épique</option>
                            <option>Premium</option>
                        </select>
                    </div>
                </div>

                {# Shop Items Table #}
                {% embed 'components/_table.html.twig' with {
                    headers: ['Image', 'Nom', 'Jeu', 'Prix', 'Ventes', 'Revenus', 'Stock', 'Actions'],
                    emptyMessage: 'Aucun article trouvé.',
                    emptyIcon: 'storefront'
                } %}
                    {% block rows %}
                        {% for item in items %}
                        <tr class="hover:bg-surface-hover transition-colors">
                            <td class="px-6 py-4">
                                <div class="h-12 w-12 rounded-lg bg-surface-dark border border-white/5 overflow-hidden flex items-center justify-center">
                                    {% if item.imageUrl %}
                                        <img src="{{ item.imageUrl }}" alt="{{ item.name }}" class="h-full w-full object-cover">
                                    {% else %}
                                        <span class="material-symbols-outlined text-white/20">image_not_supported</span>
                                    {% endif %}
                                </div>
                            </td>
                            <td class="px-6 py-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-8 h-8 rounded-lg {% if item.type == 'Skin' %}bg-purple-500/20{% else %}bg-secondary/20{% endif %} flex items-center justify-center">
                                        <span class="material-symbols-outlined {% if item.type == 'Skin' %}text-purple-400{% else %}text-secondary{% endif %} text-[18px]">
                                            {% if item.type == 'Skin' %}palette{% else %}checkroom{% endif %}
                                        </span>
                                    </div>
                                    <div>
                                        <span class="block font-semibold text-white">{{ item.name }}</span>
                                        <span class="text-[10px] uppercase font-bold tracking-wider text-white/30">{{ item.type }}</span>
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-4">
                                <span class="inline-flex px-2.5 py-1 rounded-full text-xs font-semibold bg-blue-500/20 text-blue-400">
                                    {{ item.game }}
                                </span>
                            </td>
                            <td class="px-6 py-4">
                                <span class="font-bold text-secondary">{{ item.price }}</span>
                            </td>
                            <td class="px-6 py-4 font-semibold text-white">{{ item.sales }}</td>
                            <td class="px-6 py-4">
                                <span class="font-bold text-green-400">{{ item.revenue }}</span>
                            </td>
                            <td class="px-6 py-4">
                                {% if item.stock == 'Illimité' %}
                                    <span class="inline-flex px-2.5 py-1 rounded-full text-xs font-semibold bg-blue-500/20 text-blue-400 border border-blue-500/20">
                                        Illimité
                                    </span>
                                {% elseif item.stock > 10 %}
                                    <span class="inline-flex px-2.5 py-1 rounded-full text-xs font-semibold bg-green-500/20 text-green-400 border border-green-500/20">
                                        {{ item.stock }}
                                    </span>
                                {% elseif item.stock > 0 %}
                                    <span class="inline-flex px-2.5 py-1 rounded-full text-xs font-semibold bg-yellow-500/20 text-yellow-400 border border-yellow-500/20">
                                        {{ item.stock }} (Faible)
                                    </span>
                                {% else %}
                                    <span class="inline-flex px-2.5 py-1 rounded-full text-xs font-semibold bg-red-500/20 text-red-400 border border-red-500/20">
                                        Rupture
                                    </span>
                                {% endif %}
                            </td>
                            <td class="px-6 py-4">
                                <div class="flex items-center gap-2">
                                    <a href="#" class="p-2 rounded-lg bg-white/5 hover:bg-white/10 text-white/50 hover:text-white transition-all" title="Voir">
                                        <span class="material-symbols-outlined text-[18px]">visibility</span>
                                    </a>
                                    {% if item.type == 'Skin' %}
                                        <a href="{{ path('admin_shop_skin_edit', {'id': item.id}) }}" class="p-2 rounded-lg bg-white/5 hover:bg-white/10 text-white/50 hover:text-white transition-all" title="Modifier">
                                            <span class="material-symbols-outlined text-[18px]">edit</span>
                                        </a>
                                        <form method="post" action="{{ path('admin_shop_skin_delete', {'id': item.id}) }}" onsubmit="return confirm('Supprimer ce skin ?');" class="inline">
                                            <button type="submit" class="p-2 rounded-lg bg-red-500/10 hover:bg-red-500/20 text-red-400 transition-all" title="Supprimer">
                                                <span class="material-symbols-outlined text-[18px]">delete</span>
                                            </button>
                                        </form>
                                    {% else %}
                                        <a href="{{ path('admin_shop_merch_edit', {'id': item.id}) }}" class="p-2 rounded-lg bg-white/5 hover:bg-white/10 text-white/50 hover:text-white transition-all" title="Modifier">
                                            <span class="material-symbols-outlined text-[18px]">edit</span>
                                        </a>
                                        <form method="post" action="{{ path('admin_shop_merch_delete', {'id': item.id}) }}" onsubmit="return confirm('Supprimer cet article ?');" class="inline">
                                            <button type="submit" class="p-2 rounded-lg bg-red-500/10 hover:bg-red-500/20 text-red-400 transition-all" title="Supprimer">
                                                <span class="material-symbols-outlined text-[18px]">delete</span>
                                            </button>
                                        </form>
                                    {% endif %}
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    {% endblock %}
                {% endembed %}
            </div>
        </main>
    </div>
</div>
{% endblock %}
