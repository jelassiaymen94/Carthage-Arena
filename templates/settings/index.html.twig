{% extends 'base.html.twig' %}

{% block title %}Param&egrave;tres - Carthage Arena{% endblock %}

{% block body %}
    <div
      id="mainContent"
      class="flex min-h-screen w-full opacity-0 transition-opacity duration-500"
    >
      <!-- Sidebar -->
      {% embed 'components/_sidebar.html.twig' %}
        {% block sidebar_bottom %}
        <div class="relative overflow-hidden rounded-2xl bg-gradient-to-br from-gray-900 to-black p-4 border border-white/10">
          <div class="absolute -right-6 -top-6 h-24 w-24 rounded-full bg-primary/20 blur-2xl"></div>
          <div class="relative z-10 flex flex-col gap-3">
            <div class="flex items-center justify-between">
              <p class="text-[10px] font-bold uppercase tracking-widest text-primary">
                Aide & Support
              </p>
              <span class="material-symbols-outlined text-primary text-sm">help</span>
            </div>
            <div>
              <h4 class="text-sm font-bold text-white">Besoin d'aide?</h4>
              <p class="text-xs text-gray-400 mt-1">
                Consultez notre centre d'aide.
              </p>
            </div>
          </div>
        </div>
        {% endblock %}
      {% endembed %}

      <!-- Main Content -->
      <main
        class="flex flex-1 flex-col ml-72 bg-background-dark relative"
      >
        <!-- Header -->
        <header
          class="sticky top-0 z-50 flex h-20 items-center justify-between border-b border-white/5 bg-background-dark/80 backdrop-blur-md px-8 py-4"
        >
          <div class="flex flex-col">
            <h2 class="text-2xl font-bold text-white">Param&egrave;tres</h2>
            <p class="text-xs text-gray-400">G&eacute;rez vos pr&eacute;f&eacute;rences et param&egrave;tres de compte.</p>
          </div>
          {% include 'components/_header_user_pill.html.twig' %}
        </header>

        <div class="flex flex-col gap-8 p-8 max-w-4xl mx-auto w-full">
          <!-- Flash Messages -->
          {% for message in app.flashes('success') %}
            <div class="rounded-xl bg-green-500/10 border border-green-500/30 p-4 text-sm text-green-400 flex items-center gap-2">
              <span class="material-symbols-outlined text-[20px]">check_circle</span>
              {{ message }}
            </div>
          {% endfor %}
          {% for message in app.flashes('error') %}
            <div class="rounded-xl bg-red-500/10 border border-red-500/30 p-4 text-sm text-red-400 flex items-center gap-2">
              <span class="material-symbols-outlined text-[20px]">error</span>
              {{ message }}
            </div>
          {% endfor %}

          <!-- Profile Information -->
          <section class="rounded-2xl bg-surface-dark border border-white/5 p-8">
            <h3 class="text-lg font-bold text-white flex items-center gap-3 mb-6">
              <span class="material-symbols-outlined text-primary">person</span>
              Informations du Profil
            </h3>

            {# Global form errors (like UniqueEntity) #}
            {% for error in profileForm.vars.errors %}
              <div class="rounded-xl bg-red-500/10 border border-red-500/30 p-4 mb-4 text-sm text-red-400 flex items-center gap-2">
                <span class="material-symbols-outlined text-[20px]">error</span>
                {{ error.message }}
              </div>
            {% endfor %}

            {{ form_start(profileForm, {'attr': {'class': 'flex flex-col gap-6', 'novalidate': 'novalidate', 'enctype': 'multipart/form-data'}}) }}
              <!-- Avatar Row -->
              <div class="flex items-center gap-6 mb-2">
                <div
                  id="avatarPreview"
                  class="h-20 w-20 rounded-full border-4 border-primary bg-gray-800 flex-shrink-0"
                  style="background-image: url('{{ user.avatar }}'); background-size: cover; background-position: center;"
                ></div>
                <div>
                  {{ form_widget(profileForm.avatar, {'attr': {'class': 'hidden', 'accept': 'image/jpeg,image/png,image/webp'}}) }}
                  <label for="{{ profileForm.avatar.vars.id }}" class="cursor-pointer inline-block rounded-full border border-white/10 bg-surface-hover px-5 py-2 text-sm font-bold text-gray-300 hover:bg-white/10 hover:text-white transition-all">
                    Changer l'avatar
                  </label>
                  <p class="text-xs text-gray-500 mt-1">JPG, PNG ou WebP, max 2MB.</p>
                  {% for error in profileForm.avatar.vars.errors %}
                    <p class="text-xs text-red-400 mt-1">{{ error.message }}</p>
                  {% endfor %}
                </div>
              </div>
              <!-- Fields Grid -->
              <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                <div>
                  <label for="{{ profileForm.username.vars.id }}" class="block text-sm font-medium text-gray-400 mb-2">
                    Nom d'utilisateur <span class="text-primary">*</span>
                  </label>
                  {{ form_widget(profileForm.username) }}
                  {% for error in profileForm.username.vars.errors %}
                    <p class="text-xs text-red-400 mt-1">{{ error.message }}</p>
                  {% endfor %}
                </div>
                <div>
                  <label for="{{ profileForm.email.vars.id }}" class="block text-sm font-medium text-gray-400 mb-2">
                    Adresse e-mail <span class="text-primary">*</span>
                  </label>
                  {{ form_widget(profileForm.email) }}
                  {% for error in profileForm.email.vars.errors %}
                    <p class="text-xs text-red-400 mt-1">{{ error.message }}</p>
                  {% endfor %}
                </div>
                <div>
                  <label for="settings_language" class="block text-sm font-medium text-gray-400 mb-2">
                    Langue
                  </label>
                  <select
                    id="settings_language"
                    name="language"
                    class="w-full bg-[#161616] border border-white/10 rounded-xl py-3.5 px-4 text-sm text-white focus:border-primary focus:outline-none input-glow transition-all"
                  >
                    <option {{ user.language == 'Fran&ccedil;ais' ? 'selected' : '' }}>Fran&ccedil;ais</option>
                    <option {{ user.language == 'English' ? 'selected' : '' }}>English</option>
                    <option {{ user.language == 'العربية' ? 'selected' : '' }}>العربية</option>
                  </select>
                </div>
                <div>
                  <label for="settings_timezone" class="block text-sm font-medium text-gray-400 mb-2">
                    Fuseau horaire
                  </label>
                  <select
                    id="settings_timezone"
                    name="timezone"
                    class="w-full bg-[#161616] border border-white/10 rounded-xl py-3.5 px-4 text-sm text-white focus:border-primary focus:outline-none input-glow transition-all"
                  >
                    <option {{ user.timezone == 'Africa/Tunis' ? 'selected' : '' }}>Africa/Tunis (GMT+1)</option>
                    <option {{ user.timezone == 'Europe/Paris' ? 'selected' : '' }}>Europe/Paris (GMT+1)</option>
                    <option {{ user.timezone == 'Europe/London' ? 'selected' : '' }}>Europe/London (GMT+0)</option>
                    <option {{ user.timezone == 'America/New_York' ? 'selected' : '' }}>America/New_York (GMT-5)</option>
                  </select>
                </div>
                <div>
                  <label for="settings_country" class="block text-sm font-medium text-gray-400 mb-2">
                    Pays
                  </label>
                  <select
                    id="settings_country"
                    name="country"
                    class="w-full bg-[#161616] border border-white/10 rounded-xl py-3.5 px-4 text-sm text-white focus:border-primary focus:outline-none input-glow transition-all"
                  >
                    <option {{ user.country == 'Tunisie' ? 'selected' : '' }}>Tunisie</option>
                    <option {{ user.country == 'France' ? 'selected' : '' }}>France</option>
                    <option {{ user.country == 'Alg&eacute;rie' ? 'selected' : '' }}>Alg&eacute;rie</option>
                    <option {{ user.country == 'Maroc' ? 'selected' : '' }}>Maroc</option>
                    <option {{ user.country == 'Belgique' ? 'selected' : '' }}>Belgique</option>
                  </select>
                </div>
              </div>

              <div>
                <label for="{{ profileForm.bio.vars.id }}" class="block text-sm font-medium text-gray-400 mb-2">
                  Biographie
                </label>
                {{ form_widget(profileForm.bio) }}
                {% for error in profileForm.bio.vars.errors %}
                  <p class="text-xs text-red-400 mt-1">{{ error.message }}</p>
                {% endfor %}
                <p class="text-xs text-gray-500 mt-1">Max 500 caractères.</p>
              </div>

              <div class="flex justify-end">
                <button
                  type="submit"
                  class="rounded-full bg-primary px-8 py-3 text-sm font-bold text-white shadow-lg shadow-red-900/30 hover:bg-red-600 hover:shadow-red-600/40 hover:-translate-y-0.5 transition-all flex items-center gap-2"
                >
                  <span class="material-symbols-outlined text-[18px]">save</span>
                  Enregistrer les modifications
                </button>
              </div>
            {{ form_end(profileForm) }}
          </section>

          <!-- Security -->
          <section class="rounded-2xl bg-surface-dark border border-white/5 p-8">
            <h3 class="text-lg font-bold text-white flex items-center gap-3 mb-6">
              <span class="material-symbols-outlined text-primary">lock</span>
              S&eacute;curit&eacute;
            </h3>
            <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 rounded-xl bg-white/5 p-5">
              <div>
                <p class="font-bold text-white text-sm">Mot de passe</p>
                <p class="text-xs text-gray-400 mt-0.5">Pour changer votre mot de passe, contactez le support (bientôt disponible).</p>
              </div>
            </div>
          </section>

          <!-- Notifications -->
          <section class="rounded-2xl bg-surface-dark border border-white/5 p-8">
            <h3 class="text-lg font-bold text-white flex items-center gap-3 mb-6">
              <span class="material-symbols-outlined text-primary">notifications</span>
              Notifications
            </h3>
            <div class="flex flex-col gap-4">
              <!-- Email Notifications -->
              <div class="flex items-center justify-between rounded-xl bg-white/5 p-4">
                <div>
                  <p class="font-bold text-white text-sm">Notifications par e-mail</p>
                  <p class="text-xs text-gray-400 mt-0.5">Recevoir des e-mails pour les tournois et matchs</p>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                  <input type="checkbox" checked class="sr-only peer" />
                  <div class="w-11 h-6 bg-white/10 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                </label>
              </div>
              <!-- Push Notifications -->
              <div class="flex items-center justify-between rounded-xl bg-white/5 p-4">
                <div>
                  <p class="font-bold text-white text-sm">Notifications push</p>
                  <p class="text-xs text-gray-400 mt-0.5">Notifications en temps r&eacute;el sur votre appareil</p>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                  <input type="checkbox" checked class="sr-only peer" />
                  <div class="w-11 h-6 bg-white/10 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                </label>
              </div>
              <!-- Shop Updates -->
              <div class="flex items-center justify-between rounded-xl bg-white/5 p-4">
                <div>
                  <p class="font-bold text-white text-sm">Mises &agrave; jour de la boutique</p>
                  <p class="text-xs text-gray-400 mt-0.5">Nouveaux skins et offres sp&eacute;ciales</p>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                  <input type="checkbox" class="sr-only peer" />
                  <div class="w-11 h-6 bg-white/10 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                </label>
              </div>
              <!-- Tournament Reminders -->
              <div class="flex items-center justify-between rounded-xl bg-white/5 p-4">
                <div>
                  <p class="font-bold text-white text-sm">Rappels de tournois</p>
                  <p class="text-xs text-gray-400 mt-0.5">Rappels avant le d&eacute;but de vos tournois</p>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                  <input type="checkbox" checked class="sr-only peer" />
                  <div class="w-11 h-6 bg-white/10 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                </label>
              </div>
            </div>
          </section>

          <!-- Privacy -->
          <section class="rounded-2xl bg-surface-dark border border-white/5 p-8">
            <h3 class="text-lg font-bold text-white flex items-center gap-3 mb-6">
              <span class="material-symbols-outlined text-primary">shield</span>
              Confidentialit&eacute;
            </h3>
            <div class="flex flex-col gap-4">
              <div class="flex items-center justify-between rounded-xl bg-white/5 p-4">
                <div>
                  <p class="font-bold text-white text-sm">Profil public</p>
                  <p class="text-xs text-gray-400 mt-0.5">Permettre aux autres de voir votre profil</p>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                  <input type="checkbox" checked class="sr-only peer" />
                  <div class="w-11 h-6 bg-white/10 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                </label>
              </div>
              <div class="flex items-center justify-between rounded-xl bg-white/5 p-4">
                <div>
                  <p class="font-bold text-white text-sm">Afficher les statistiques</p>
                  <p class="text-xs text-gray-400 mt-0.5">Rendre vos stats visibles publiquement</p>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                  <input type="checkbox" checked class="sr-only peer" />
                  <div class="w-11 h-6 bg-white/10 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                </label>
              </div>
            </div>
          </section>

          <!-- Danger Zone -->
          <section class="rounded-2xl bg-surface-dark border border-red-500/30 p-8">
            <h3 class="text-lg font-bold text-red-400 flex items-center gap-3 mb-6">
              <span class="material-symbols-outlined">warning</span>
              Zone de Danger
            </h3>
            <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 rounded-xl bg-red-500/5 border border-red-500/20 p-5">
              <div>
                <p class="font-bold text-red-400 text-sm">Supprimer le compte</p>
                <p class="text-xs text-gray-400 mt-0.5">Cette action est irr&eacute;versible. Toutes vos donn&eacute;es seront d&eacute;finitivement supprim&eacute;es.</p>
              </div>
              <button class="flex-shrink-0 rounded-full bg-red-500 px-6 py-2.5 text-sm font-bold text-white hover:bg-red-600 transition-all flex items-center gap-2">
                <span class="material-symbols-outlined text-[18px]">delete_forever</span>
                Supprimer le compte
              </button>
            </div>
          </section>
        </div>
        {% include 'components/_mobile_nav.html.twig' %}
</main>
    </div>
{% endblock %}

{% block javascripts %}
    <script>
      const avatarInput = document.getElementById('{{ profileForm.avatar.vars.id }}');
      if (avatarInput) {
        avatarInput.addEventListener('change', function(e) {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function(ev) {
              document.getElementById('avatarPreview').style.backgroundImage = 'url(' + ev.target.result + ')';
            };
            reader.readAsDataURL(file);
          }
        });
      }
    </script>
{% endblock %}

